# Architecture Overview

## High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           JENKINS CONTROLLER                                │
│                                                                             │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐         │
│  │   Jenkinsfile   │───►│ Shared Library  │───►│   Pipeline      │         │
│  │   (Your Repo)   │    │ (mobile-ci-cd)  │    │   Execution     │         │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘         │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           DOCKER AGENT                                      │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │              react-native-android:latest                             │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │   │
│  │  │ Java 17  │ │ Node 20  │ │Android   │ │Fastlane  │ │ Gradle   │   │   │
│  │  │          │ │          │ │SDK 34    │ │          │ │          │   │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    ▼               ▼               ▼
            ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
            │   Nexus      │ │ Google Play  │ │   Slack      │
            │   Registry   │ │   Store      │ │              │
            └──────────────┘ └──────────────┘ └──────────────┘
```

## Component Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        SHARED LIBRARY STRUCTURE                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         vars/ (Entry Points)                         │   │
│  │  ┌────────────────┐ ┌────────────────┐ ┌────────────────┐           │   │
│  │  │androidPipeline │ │ androidBuild   │ │ androidTest    │           │   │
│  │  └───────┬────────┘ └───────┬────────┘ └───────┬────────┘           │   │
│  │          │                  │                  │                     │   │
│  │  ┌────────────────┐ ┌────────────────┐ ┌────────────────┐           │   │
│  │  │ androidDeploy  │ │ notifyBuild    │ │withAndroidSign │           │   │
│  │  └───────┬────────┘ └───────┬────────┘ └───────┬────────┘           │   │
│  └──────────┼──────────────────┼──────────────────┼─────────────────────┘   │
│             │                  │                  │                         │
│             ▼                  ▼                  ▼                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    src/jenkins/pipeline/ (Core)                      │   │
│  │                                                                      │   │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐        │   │
│  │  │   mobile/  │ │  testing/  │ │    ci/     │ │notification│        │   │
│  │  │AndroidBuilder│JestRunner │ │FastlaneExec│ │SlackNotifier│       │   │
│  │  └────────────┘ │AppiumRunner│ │DockerMgr  │ └────────────┘        │   │
│  │                 └────────────┘ └────────────┘                       │   │
│  │                                                                      │   │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐        │   │
│  │  │  models/   │ │  config/   │ │interfaces/ │ │   utils/   │        │   │
│  │  │BuildConfig │ │FastlaneCfg │ │ IBuilder   │ │CommandBldr │        │   │
│  │  └────────────┘ │AndroidCfg  │ │ITestRunner │ │ FileUtils  │        │   │
│  │                 └────────────┘ └────────────┘ └────────────┘        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Data Flow

```
User Repo                  Shared Library                    External Services
─────────                  ──────────────                    ─────────────────

Jenkinsfile ─────────────► androidPipeline()
                                  │
                                  ├──► gitCheckout()
                                  │
                                  ├──► setupEnv()
                                  │
                                  ├──► androidBuild() ────────► Gradle
                                  │         │
                                  │         └───────────────► APK/AAB
                                  │
                                  ├──► androidTest()
                                  │         │
                                  │         ├──► JestRunner ───► Jest
                                  │         │
                                  │         └──► AppiumRunner ─► Appium/Emulator
                                  │
                                  ├──► androidDeploy() ──────► Google Play Store
                                  │         │
                                  │         └──► FastlaneExecutor
                                  │
                                  └──► notifyBuild() ────────► Slack
```
